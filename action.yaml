#   ########################################################################
#   Copyright 2021 Splunk Inc.
#
#    Licensed under the Apache License, Version 2.0 (the "License");
#    you may not use this file except in compliance with the License.
#    You may obtain a copy of the License at
#
#        http://www.apache.org/licenses/LICENSE-2.0
#
#    Unless required by applicable law or agreed to in writing, software
#    distributed under the License is distributed on an "AS IS" BASIS,
#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#    See the License for the specific language governing permissions and
#    limitations under the License.
#   ########################################################################
# action.yml
name: 'Workflow engine test runner'
description: 'Tringger argo workflow'
inputs:
  splunk:  # id of input
    description: 'Splunk version to test.'
    required: true
  test-type:
    description: 'Type of tests to execute'
    required: true
  test-args:
    description: 'Pytest args for tests'
    required: false
  job-name:
    description: 'Name for the Job'
    required: true
  labels:
    description: 'Labels for argo workflow execution'
    required: false
  workflow-tmpl-name:
    description: 'Name of workflow template to trigger'
    required: true
  workflow-template-ns:
    description: 'Namespace where the orkflow template lies'
    required: false
    default: 'default'
  destroy-setup:
    description: 'Destroy the Infrastructure set up for testing'
    required: false
    default: 'Yes'
  addon-url:
    description: 'URL for Add-on spl'
    required: true

outputs:
  workflow-name: # id of output
    description: 'Name of workflow triggered'
runs:
  using: 'docker'
  image: 'Dockerfile'
  args:
    - ${{ inputs.workflow-tmpl-name }}
    - ${{ inputs.workflow-template-ns }}
    - ${{ inputs.destroy-setup }}
    - ${{ inputs.addon-url }}
    - ${{ inputs.job-name }}
    - ${{ inputs.splunk }}
    - ${{ inputs.test-type }}
    - ${{ inputs.test-args }}
    - ${{ inputs.labels }}

